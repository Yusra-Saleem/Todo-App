# API Contract: PUT /api/tasks/{id}

## Endpoint Definition

```
PUT /api/tasks/{id}
```

### Description
Updates an existing task belonging to the authenticated user. The endpoint enforces ownership verification by checking that the authenticated user ID matches the task's user_id.

### Authentication
- JWT Bearer token required in Authorization header
- Uses get_current_user_id dependency for authentication
- Returns 401 Unauthorized for invalid or missing tokens
- Returns 403 Forbidden if the task does not belong to the authenticated user

## Request

### Headers
```
Authorization: Bearer {jwt_token}
Content-Type: application/json
```

### Path Parameters
- `id`: Required, string (UUID format) - The primary key of the task to update

### Query Parameters
- None

### Request Body
```json
{
  "title": "optional string (max 255)",
  "description": "optional string",
  "is_completed": "optional boolean"
}
```

## Response

### Success Response (200 OK)
```json
{
  "id": "string (UUID)",
  "title": "string (max 255)",
  "is_completed": "boolean",
  "created_at": "string (ISO 8601 datetime)",
  "updated_at": "string (ISO 8601 datetime)",
  "user_id": "string (UUID)"
}
```

### Error Responses

#### 401 Unauthorized
```json
{
  "detail": "Could not validate credentials"
}
```

#### 403 Forbidden
```json
{
  "detail": "You do not have permission to update this task"
}
```

#### 404 Not Found
```json
{
  "detail": "Task not found"
}
```

#### 422 Validation Error
```json
{
  "detail": [
    {
      "loc": ["body", "title"],
      "msg": "ensure this value has at most 255 characters",
      "type": "value_error.any_str.max_length"
    }
  ]
}
```

## Business Logic

1. Authenticates user using JWT token
2. Verifies task ownership by checking that both the task ID and user ID match the requested resource
3. Validates input data according to TaskUpdate Pydantic model
4. Updates only the fields provided in the request (partial updates allowed)
5. Updates the updated_at timestamp
6. Returns updated Task object

## Validation Rules

- Task title must be 255 characters or less if provided
- Task description must be provided if field is included in request body
- is_completed must be a boolean value if provided
- Request body fields are optional to support partial updates
- User can only update tasks that belong to them (enforced by database query)

## Example Request
```
PUT /api/tasks/a1b2c3d4-e5f6-7890-1234-567890abcdef
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
Content-Type: application/json

{
  "title": "Updated task title",
  "is_completed": true
}
```

## Example Response
```
Status: 200 OK
{
  "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "title": "Updated task title",
  "is_completed": true,
  "created_at": "2023-10-15T14:30:00Z",
  "updated_at": "2023-10-16T09:15:00Z",
  "user_id": "user123-4567-8901-abcdef123456"
}
```